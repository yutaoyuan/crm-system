<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>客户资料管理系统 - 客户管理</title>
  <link rel="stylesheet" href="/lib/antd.min.css">
  <link rel="stylesheet" href="../css/style.css">
  <script src="/lib/antd.min.js"></script>
  <!-- 优化组件加载器 -->
  <script src="../js/components/loader.js"></script>
</head>
<body>
  <!-- 页面头部 -->
  <div class="ant-layout-header">
    <div class="ant-pro-global-header">
      <div class="ant-pro-global-header-content">
        <div class="ant-pro-global-header-logo">客户资料管理系统</div>
        <div class="ant-pro-global-header-right">
          <span class="ant-pro-global-header-index-right" id="current-user">用户名</span>
          <button id="logout-button" class="ant-btn ant-btn-danger">退出登录</button>
        </div>
      </div>
    </div>
  </div>
  
  <div class="ant-pro-basicLayout-content">
    <div class="ant-pro-basicLayout-children-content-wrap">
      <!-- 左侧菜单 -->
      <div class="ant-layout-sider">
        <ul class="ant-menu ant-menu-root ant-menu-inline">
          <li class="ant-menu-item ant-menu-item-selected">
            <a href="/pages/customers.html" class="ant-menu-item-link">客户管理</a>
          </li>
          <li class="ant-menu-item">
            <a href="/pages/sales.html" class="ant-menu-item-link">销售管理</a>
          </li>
          <li class="ant-menu-item">
            <a href="/pages/points.html" class="ant-menu-item-link">积分管理</a>
          </li>
          <li class="ant-menu-item">
            <a href="/pages/visits.html" class="ant-menu-item-link">回访管理</a>
          </li>
        </ul>
      </div>
      
      <!-- 主要内容 -->
      <div class="ant-layout-content">
        <div class="ant-pro-page-container">
          <h2 class="ant-typography">客户管理</h2>
          
          <!-- 工具栏 -->
          <div class="ant-pro-table-search" style="display: flex; justify-content: space-between;">
            <div class="ant-space ant-space-horizontal ant-space-align-center">
              <button id="create-customer-btn" class="ant-btn ant-btn-primary">新建</button>
              <button id="export-customers-btn" class="ant-btn ant-btn-primary" style="margin-left: 8px;">导出</button>
              <button id="fix-consumption-btn" class="ant-btn ant-btn-warning" style="margin-left: 8px;" title="修复客户最近消费数据">修复数据</button>
            </div>
            <div class="ant-pro-table-search-query-filter" style="display: flex; align-items: center;">
              <div class="ant-input-group" style="margin-right: 10px; display: flex; align-items: center;">
                <select id="employee-select" class="ant-input" style="width: 160px; margin-right: 8px;">
                  <option value="">归属员工</option>
                  <option value="赵春燕">赵春燕</option>
                  <option value="余夏莲">余夏莲</option>
                  <option value="赵秀丽">赵秀丽</option>
                  <option value="其他">其他</option>
                </select>
                <input type="text" id="employee-other-input" class="ant-input" placeholder="请输入员工姓名" style="width: 160px; margin-right: 8px; display: none;">
                <input type="text" id="search-input" placeholder="输入电话或姓名..." class="ant-input">
                <button id="search-btn" class="ant-btn ant-btn-primary">搜索</button>
              </div>
              <button id="toggle-columns-btn" class="ant-btn">显示/隐藏字段</button>
            </div>
          </div>      
          <!-- 客户列表 -->
          <div class="ant-table">
            <table id="customers-table" class="ant-table-content">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>姓名</th>
                  <th>电话</th>
                  <th>照片</th>
                  <th>年龄</th>
                  <th>身高</th>
                  <th>上衣码数</th>
                  <th>下衣码数</th>
                  <th>体型</th>
                  <th>特征</th>
                  <th>接待</th>
                  <th>性格</th>
                  <th>偏爱色系</th>
                  <th>偏爱风格</th>
                  <th>陪同</th>
                  <th>归属部门</th>
                  <th>归属员工</th>
                  <th>建档日期</th>
                  <th>消费金额</th>
                  <th>消费数量</th>
                  <th>消费次数</th>
                  <th>累计积分</th>
                  <th>可用积分</th>
                  <th>最近消费</th>
                  <th>最近回访</th>
                </tr>
              </thead>
              <tbody id="customers-list">
                <!-- 客户数据将通过JavaScript动态加载 -->
              </tbody>
            </table>
          </div>
          
          <!-- 分页控件 -->
          <div id="pagination" class="pagination">
            <!-- 分页内容将通过JavaScript动态加载 -->
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 新建/编辑客户模态框 -->
  <div id="customer-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">新建客户</h3>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <form id="customer-form">
          <div class="form-grid">
            <div class="form-group">
              <label for="customer-name">姓名 *</label>
              <input type="text" id="customer-name" name="name" required>
            </div>
            <div class="form-group">
              <label for="customer-phone">电话 *</label>
              <input type="text" id="customer-phone" name="phone" required>
            </div>
            <div class="form-group">
              <label for="customer-age">年龄</label>
              <input type="number" id="customer-age" name="age">
            </div>
            <div class="form-group">
              <label for="customer-height">身高</label>
              <input type="text" id="customer-height" name="height">
            </div>
            <div class="form-group">
              <label for="customer-upper-size">上衣码数</label>
              <select id="customer-upper-size" name="upper_size">
                <option value="">请选择</option>
                <option value="1码">1码</option>
                <option value="2码">2码</option>
                <option value="3码">3码</option>
                <option value="4码">4码</option>
                <option value="5码">5码</option>
                <option value="6码">6码</option>
              </select>
            </div>
            <div class="form-group">
              <label for="customer-lower-size">下衣码数</label>
              <select id="customer-lower-size" name="lower_size">
                <option value="">请选择</option>
                <option value="1码">1码</option>
                <option value="2码">2码</option>
                <option value="3码">3码</option>
                <option value="4码">4码</option>
                <option value="5码">5码</option>
                <option value="6码">6码</option>
              </select>
            </div>
            <div class="form-group">
              <label for="customer-body-type">体型</label>
              <select id="customer-body-type" name="body_type">
                <option value="">请选择</option>
                <option value="S型：三围曲线明显">S型：三围曲线明显</option>
                <option value="A型：上身苗条，下身发胖">A型：上身苗条，下身发胖</option>
                <option value="V型：上身宽大，下身纤细">V型：上身宽大，下身纤细</option>
                <option value="O型：上下正常，腰部圆润">O型：上下正常，腰部圆润</option>
              </select>
            </div>
            <div class="form-group">
              <label for="customer-features">特征</label>
              <input type="text" id="customer-features" name="features">
            </div>
            <div class="form-group">
              <label for="customer-reception">接待</label>
              <select id="customer-reception" name="reception">
                <option value="">请选择</option>
                <option value="犹豫型">犹豫型</option>
                <option value="冲动型">冲动型</option>
                <option value="理智型">理智型</option>
                <option value="推荐型">推荐型</option>
              </select>
            </div>
            <div class="form-group">
              <label for="customer-personality">性格</label>
              <input type="text" id="customer-personality" name="personality" readonly>
            </div>
            <div class="form-group">
              <label for="customer-color-preference">偏爱色系</label>
              <div class="custom-select">
                <select id="customer-color-preference" name="color_preference" multiple>
                  <option value="黑白">黑白</option>
                  <option value="深色">深色</option>
                  <option value="浅色">浅色</option>
                  <option value="其他">其他</option>
                </select>
                <div class="select-options"></div>
              </div>
            </div>
            <div class="form-group">
              <label for="customer-style-preference">偏爱风格</label>
              <div class="custom-select">
                <select id="customer-style-preference" name="style_preference" multiple>
                  <option value="个性时尚">个性时尚</option>
                  <option value="职业气质">职业气质</option>
                  <option value="简单大方">简单大方</option>
                  <option value="甜美女人">甜美女人</option>
                  <option value="中性休闲">中性休闲</option>
                  <option value="其他">其他</option>
                </select>
                <div class="select-options"></div>
              </div>
            </div>
            <div class="form-group">
              <label for="customer-accompaniment">陪同</label>
              <input type="text" id="customer-accompaniment" name="accompaniment">
            </div>
            <div class="form-group">
              <label for="customer-department">归属部门</label>
              <select id="customer-department" name="department">
                <option value="成都青羊光华店" selected>成都青羊光华店</option>
              </select>
            </div>
            <div class="form-group">
              <label for="customer-employee">归属员工</label>
              <select id="customer-employee" name="employee">
                <option value="">请选择</option>
                <option value="赵春燕">赵春燕</option>
                <option value="余夏莲">余夏莲</option>
                <option value="赵秀丽">赵秀丽</option>
              </select>
            </div>
            <div class="form-group">
              <label for="customer-registration-date">建档日期</label>
              <input type="date" id="customer-registration-date" name="registration_date">
            </div>
            <div class="form-group">
              <label for="customer-photo">客户照片</label>
              <input type="file" id="customer-photo" accept="image/*" onchange="previewPhoto()">
              <div class="file-upload-warning">图片大小不应超过10MB，超过2MB将自动压缩</div>
              <div id="photo-preview"></div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button id="cancel-customer-btn" class="ant-btn ant-btn">取消</button>
        <button id="save-customer-btn" class="ant-btn btn-primary">保存</button>
      </div>
    </div>
  </div>
  
  <!-- 查看客户详情模态框 -->
  <div id="customer-detail-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">客户详情</h3>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body" id="customer-detail-content">
        <!-- 页面切换按钮 -->
        <div class="page-tabs" style="margin-bottom: 20px; border-bottom: 1px solid #d9d9d9;">
          <button class="page-tab active" data-page="basic-info">基本信息</button>
          <button class="page-tab" data-page="consumption-details">消费详情</button>
          <button class="page-tab" data-page="visit-records">回访记录</button>
        </div>
        
        <!-- 基本信息页面 -->
        <div id="basic-info-page" class="page-content active">
          <!-- 基本信息内容将通过JavaScript动态加载 -->
        </div>
        
        <!-- 消费详情页面 -->
        <div id="consumption-details-page" class="page-content">
          <div class="consumption-details-content">
            <!-- 消费详情内容将通过JavaScript动态加载 -->
          </div>
        </div>
        
        <!-- 回访记录页面 -->
        <div id="visit-records-page" class="page-content">
          <div class="visit-records-content">
            <!-- 回访记录内容将通过JavaScript动态加载 -->
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="edit-customer-btn" class="ant-btn ant-btn-primary">编辑</button>
        <button id="delete-customer-btn" class="ant-btn ant-btn-danger">删除</button>
        <button id="close-detail-btn" class="ant-btn ant-btn">关闭</button>
      </div>
    </div>
  </div>
  
  <!-- 字段显示/隐藏弹窗 -->
  <div id="columns-modal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3 class="modal-title">字段显示/隐藏设置</h3>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <div id="column-toggles" class="checkbox-group" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
          <!-- 字段复选框将通过JavaScript动态生成 -->
        </div>
      </div>
      <div class="modal-footer">
        <button id="reset-columns-btn" class="ant-btn">重置</button>
        <button id="apply-columns-btn" class="ant-btn ant-btn-primary">应用</button>
      </div>
    </div>
  </div>
  
  <!-- 新增回访记录弹窗 -->
  <div id="visit-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">新增回访记录</h3>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <form id="visit-form">
          <input type="hidden" id="visit-customer-id">
          <div class="form-group">
            <label for="visit-customer-name">客户姓名</label>
            <input type="text" id="visit-customer-name" readonly>
          </div>
          <div class="form-group">
            <label for="visit-customer-phone">客户电话</label>
            <input type="text" id="visit-customer-phone" readonly>
          </div>
          <div class="form-group">
            <label for="visit-date">回访日期 *</label>
            <input type="date" id="visit-date" required>
          </div>
          <div class="form-group">
            <label for="visit-type">回访方式 *</label>
            <select id="visit-type" required>
              <option value="">请选择回访方式</option>
              <option value="电话">电话</option>
              <option value="短信">短信</option>
              <option value="微信">微信</option>
              <option value="上门">上门</option>
              <option value="其他">其他</option>
            </select>
          </div>
          <div class="form-group">
            <label for="visit-purpose">回访目的</label>
            <select id="visit-purpose">
              <option value="">请选择回访目的</option>
              <option value="产品介绍">产品介绍</option>
              <option value="活动邀请">活动邀请</option>
              <option value="满意度调查">满意度调查</option>
              <option value="售后跟进">售后跟进</option>
              <option value="生日祝福">生日祝福</option>
              <option value="其他">其他</option>
            </select>
          </div>
          <div class="form-group">
            <label for="visit-result">回访结果</label>
            <select id="visit-result">
              <option value="">请选择回访结果</option>
              <option value="有意向">有意向</option>
              <option value="考虑中">考虑中</option>
              <option value="需要再次回访">需要再次回访</option>
              <option value="无意向">无意向</option>
              <option value="未接通">未接通</option>
            </select>
          </div>
          <div class="form-group">
            <label for="visit-notes">回访备注</label>
            <textarea id="visit-notes" rows="4"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button id="cancel-visit-btn" class="ant-btn">取消</button>
        <button id="save-visit-btn" class="ant-btn ant-btn-primary">保存</button>
      </div>
    </div>
  </div>
  
  <script src="../js/common.js"></script>
  <script src="../js/customers.js"></script>
</body>
</html>