<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>客户资料管理系统 - 积分管理</title>
    <link rel="stylesheet" href="/lib/antd.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <script src="/lib/antd.min.js"></script>
    <!-- 优化组件加载器 -->
    <script src="../js/components/loader.js"></script>
</head>
<body>
    <!-- 页面头部 -->
    <div class="ant-layout-header">
        <div class="ant-pro-global-header">
            <div class="ant-pro-global-header-content">
                <div class="ant-pro-global-header-logo">客户资料管理系统</div>
                <div class="ant-pro-global-header-right">
                    <span class="ant-pro-global-header-index-right" id="current-user">用户名</span>
                    <button id="logout-button" class="ant-btn ant-btn-danger">退出登录</button>
                </div>
            </div>
        </div>
    </div>

    <div class="ant-pro-basicLayout-content">
        <div class="ant-pro-basicLayout-children-content-wrap">
            <!-- 左侧菜单 -->
            <div class="ant-layout-sider">
                <ul class="ant-menu ant-menu-root ant-menu-inline">
                    <li class="ant-menu-item">
                        <a href="/pages/customers.html" class="ant-menu-item-link">客户管理</a>
                    </li>
                    <li class="ant-menu-item">
                        <a href="/pages/sales.html" class="ant-menu-item-link">销售管理</a>
                    </li>
                    <li class="ant-menu-item ant-menu-item-selected">
                        <a href="/pages/points.html" class="ant-menu-item-link">积分管理</a>
                    </li>
                    <li class="ant-menu-item">
                        <a href="/pages/visits.html" class="ant-menu-item-link">回访管理</a>
                    </li>
                </ul>
            </div>

            <!-- 主要内容 -->
            <div class="ant-layout-content">
                <div class="ant-pro-page-container">
                    <h2 class="ant-typography">积分管理</h2>
                    
                    <!-- 工具栏 -->
                    <div class="ant-pro-table-search" style="display: flex; justify-content: space-between;">

                        <div class="ant-space ant-space-horizontal ant-space-align-center">
                            <button id="create-points-btn" class="ant-btn ant-btn-primary">新建</button>
                        </div>
                        <div class="ant-pro-table-search-query-filter">
                            <div class="ant-input-group">
                                <input type="text" id="search-input" placeholder="输入电话或姓名..." class="ant-input">
                                <button id="search-btn" class="ant-btn ant-btn-primary ant-input-search-button">搜索</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 积分列表 -->
                    <div class="ant-table">
                        <table id="points-table" class="ant-table-content">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>姓名</th>
                                    <th>电话</th>
                                    <th>积分</th>
                                    <th>途径</th>
                                    <th>日期</th>
                                    <th>操作员</th>
                                    <th>备注</th>
                                </tr>
                            </thead>
                            <tbody id="points-table-body">
                                <!-- 积分数据将通过JavaScript动态加载 -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- 加载指示器 -->
                    <div id="loading-spinner" class="loading-spinner" style="display: none;">
                        <div class="spinner"></div>
                    </div>
                    
                    <!-- 分页控件 -->
                    <div id="pagination" class="pagination">
                        <!-- 分页内容将通过JavaScript动态加载 -->
                    </div>
                    
                    <!-- 警告消息区域 -->
                    <div id="main-alert" class="alert-container"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 新建/编辑积分模态框 -->
    <div id="points-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="points-modal-title">新建积分记录</h3>
                <span class="modal-close close-modal" style="cursor: pointer;">&times;</span>
            </div>
            <div class="modal-body">
                <div id="points-form-alert" class="alert-container"></div>
                <form id="points-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="customer_search">客户搜索 *</label>
                            <div class="customer-select-container">
                                <input type="text" id="customer_search" placeholder="输入电话号码搜索客户..." class="form-control" autocomplete="off">
                                <div id="customer_dropdown" class="customer-dropdown"></div>
                                <input type="hidden" id="customer_id" name="customer_id" required>
                                <div id="customer_selected" class="customer-selected-info" style="display:none;"></div>
                                <div id="customer_points_info" class="customer-points-info" style="display: none;">
                                    <span>可用积分: </span>
                                    <span id="available_points">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="type">途径 *</label>
                            <select id="type" name="type" required>
                                <option value="redeemed">积分兑换</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="points">积分 *</label>
                            <input type="number" id="points" name="points" required>
                            <p class="form-help">请输入积分数量，负数表示使用积分</p>
                        </div>
                        <div class="form-group">
                            <label for="date">日期 *</label>
                            <input type="date" id="date" name="date" required>
                        </div>
                        <div class="form-group">
                            <label for="operator">操作员</label>
                            <input type="text" id="operator" name="operator" value="店长">
                        </div>
                        <div class="form-group" style="grid-column: span 2;">
                            <label for="description">备注</label>
                            <textarea id="description" name="description" rows="3"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="ant-btn ant-btn btn-default close-modal">取消</button>
                <button type="submit" form="points-form" class="ant-btn ant-btn btn-primary">保存</button>
            </div>
        </div>
    </div>

    <!-- 积分详情模态框 -->
    <div id="detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">积分详情</h3>
                <span class="modal-close close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="detail-section">
                    <h4>客户信息</h4>
                    <div class="detail-row">
                        <div class="detail-label">姓名:</div>
                        <div class="detail-value" id="detail-customer-name"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">电话:</div>
                        <div class="detail-value" id="detail-customer-phone"></div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h4>积分信息</h4>
                    <div class="detail-row">
                        <div class="detail-label">途径:</div>
                        <div class="detail-value" id="detail-type"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">积分:</div>
                        <div class="detail-value" id="detail-points"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">日期:</div>
                        <div class="detail-value" id="detail-date"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">操作员:</div>
                        <div class="detail-value" id="detail-operator"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">备注:</div>
                        <div class="detail-value" id="detail-description"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="ant-btn ant-btn-danger" id="delete-point-btn">删除</button>
                <button class="ant-btn ant-btn close-modal">关闭</button>
            </div>
        </div>
    </div>

    <script src="../js/common.js"></script>
    <script src="../js/points.js"></script>
</body>
</html>